var Pandyle;(function(t){function e(e){return t._methods[e]}function a(t,e){var a=new RegExp("^\\w+"+e+"$");return a.test(t)}function n(e,n){$.isFunction(n)?a(e,"Filter")?t._filters[e]=n:a(e,"Converter")?t._converters[e]=n:t._methods[e]=n:t._variables[e]=n}function r(e){for(var a in e)t._config[a]=e[a]}t._variables={},t._methods={},t._filters={},t._converters={},t._components={},t._config={},t.getMethod=e,t.hasSuffix=a,t.register=n,t.config=r})(Pandyle||(Pandyle={}));var Pandyle;(function(t){function e(e){return"undefined"!=typeof t._components[e]}function a(e){t._components[e.name]=e.html}function n(e){return t._components[e]}function r(r){function i(t,e){t=t.replace(/<\s*script\s*>((?:.|\r|\n)*?)<\/script\s*>/g,function(t,e){return new Function(e)(),""}),t=t.replace(/<\s*style\s*>((?:.|\r|\n)*?)<\/style\s*>/g,function(t,e){var a=$("<style></style>").html(e);return $("head").append(a),""}),a({name:e,html:t}),$(r).html(t)}var o=t._config.comPath||"/components/",s=$(r).attr("p-com");if(e(s))$(r).html(n(s));else{var p="";p=/.*\.html$/.test(s)?s:o+s+".html",$.ajax({url:p,dataType:"html",async:!1,success:function(t){i(t,s)}})}}t.hasComponent=e,t.addComponent=a,t.getComponent=n,t.loadComponent=r})(Pandyle||(Pandyle={})),function(t){t.fn.vm=function(t,e){void 0===e&&(e=!0);var a=this;if(a.data("vm"))return a.data("vm");var n=new Pandyle.VM(a,t,e);return a.data("vm",n),n},t.fn.inputs=function(){var t=this;if(t.data("inputs"))return t.data("inputs");var e=new Pandyle.Inputs(t);return t.data("inputs",e),e}}(jQuery);var Pandyle;(function(t){var e=function(){function t(t){this._data={},this._root=t,this.initData(),this.bindChange()}return Object.defineProperty(t.prototype,"data",{get:function(){return $.extend({},this._data)},enumerable:!0,configurable:!0}),t.prototype.set=function(t){for(var e in t){this.setData(e,t[e]);var a=this._root.find('[name="'+e+'"]');this.updateDom(a,t[e]),a.trigger("modelChange",t[e])}},t.prototype.initData=function(){var t=this;this._root.find("input,textarea,select").each(function(e,a){var n=$(a),r=n.prop("tagName"),i=n.prop("name");switch(t.initName(i),r){case"INPUT":t.initData_input(n);break;case"TEXTAREA":t.initData_normal(n);break;case"SELECT":t.initData_select(n)}})},t.prototype.initData_input=function(t){var e=t.prop("type");switch(e){case"radio":this.initData_radio(t);break;case"checkbox":this.initData_check(t);break;default:this.initData_normal(t)}},t.prototype.initData_radio=function(t){var e=t.prop("name"),a=t.val();$.isEmptyObject(this.getDataByName(e))&&this.setData(e,""),t.prop("checked")&&this.setData(e,a)},t.prototype.initData_check=function(t){var e=t.prop("name"),a=t.val();$.isEmptyObject(this.getDataByName(e))&&this.setData(e,[]),t.prop("checked")&&this.getDataByName(e).push(a)},t.prototype.initData_normal=function(t){var e=t.prop("name"),a=t.val();this.setData(e,a)},t.prototype.initData_select=function(t){var e=t.prop("name"),a=t.val()||"";this.setData(e,a)},t.prototype.bindChange=function(){var t=this;this._root.on("change","input,textarea,select",function(e){var a=$(e.currentTarget),n=a.prop("tagName");switch(n){case"INPUT":t.onChange_input(a);break;case"TEXTAREA":t.onChange_normal(a);break;case"SELECT":t.onChange_select(a)}})},t.prototype.onChange_normal=function(t){var e=t.prop("name"),a=t.val();this.setData(e,a)},t.prototype.onChange_input=function(t){switch(t.prop("type")){case"radio":this.onChange_radio(t);break;case"checkbox":this.onChange_check(t);break;default:this.onChange_normal(t)}},t.prototype.onChange_radio=function(t){var e=t.prop("name"),a=t.val();t.prop("checked")&&this.setData(e,a)},t.prototype.onChange_check=function(t){var e=t.prop("name"),a=t.val();if(t.prop("checked"))this.getDataByName(e).push(a);else{var n=this.getDataByName(e).indexOf(a);this.getDataByName(e).splice(n,1)}},t.prototype.onChange_select=function(t){var e=t.prop("name"),a=t.val();this.setData(e,a)},t.prototype.initName=function(t){t.split(".").reduce(function(t,e){return t[e]?t[e]:(t[e]={},t[e])},this._data)},t.prototype.getDataByName=function(t){return t.split(".").reduce(function(t,e){return t[e]},this._data)},t.prototype.setData=function(t,e){var a=t.split("."),n=a.pop(),r=a.reduce(function(t,e){return t[e]},this._data);r[n]=e},t.prototype.updateDom=function(t,e){var a=t.prop("tagName");switch(a){case"INPUT":this.updateDom_input(t,e);break;case"TEXTAREA":this.updateDom_normal(t,e);break;case"SELECT":this.updateDom_select(t,e);break;default:this.updateDom_normal(t,e)}},t.prototype.updateDom_input=function(t,e){var a=t.prop("type");switch(a){case"radio":this.updateDom_radio(t,e);break;case"checkbox":this.updateDom_check(t,e);break;default:this.updateDom_normal(t,e)}},t.prototype.updateDom_radio=function(t,e){t.each(function(t,a){var n=$(a);n.val()==e?n.prop("checked","checked"):n.removeProp("checked")})},t.prototype.updateDom_check=function(t,e){t.each(function(t,a){var n=$(a);e.indexOf(n.val())>-1?n.prop("checked","checked"):n.removeProp("checked")})},t.prototype.updateDom_normal=function(t,e){t.val(e)},t.prototype.updateDom_select=function(t,e){t.val(e)},t}();t.Inputs=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(){function e(t,e,a){void 0===a&&(a=!0),this._data=$.extend({},e),this._root=t,this._relations=[],this._methods={},this._filters={},this._converters={},this._variables={},this._defaultAlias={root:{data:this._data,property:""},window:{data:window,property:"@window"}},a&&this.run()}return e.prototype.set=function(t){var e=this,a=function(a){var r=a.split("."),i=r.pop(),o=n._data;if(r.length>0&&(o=r.reduce(function(t,e){return t[e]},n._data)),o[i]=t[a],$.isArray(o[i]))for(var s=n._relations.length-1;s>=0;s--)n.isChild(a,n._relations[s].property)&&n._relations.splice(s,1);var p=n._relations.filter(function(t){return e.isSelfOrChild(a,t.property)});p.length>0&&p[0].elements.forEach(function(t){e.render(t)})},n=this;for(var r in t)a(r)},e.prototype.get=function(t){var e=this;switch($.type(t)){case"array":return t.map(function(t){return e.get(t)});case"string":return this.getValue(this._root,t,this._data);case"object":var a={};for(var n in t)a[n]=this.getValue(this._root,t[n],this._data);return a;default:return null}},e.prototype.run=function(){this.render(this._root,this._data,"",this._defaultAlias)},e.prototype.render=function(t,e,a,n){var r=this;t.each(function(t,i){r.renderSingle(i,e,a,$.extend({},n))})},e.prototype.renderSingle=function(e,a,n,r){var i=$(e);i.data("context")||i.data("context",a),i.data("binding")||i.data("binding",{}),r&&i.data("alias",r),a=i.data("context"),this.bindAttr(e,n),this.bindIf(e,n),"C"===i[0].tagName&&t.loadComponent(e),i.attr("p-context")?this.renderContext(e,n):i.attr("p-each")?(this.setAlias(i,n,a),this.renderEach(i,a,n)):i.children().length>0?(this.setAlias(i,n,a),this.renderChild(e,a,n)):(this.setAlias(i,n,a),this.renderText(i,n))},e.prototype.bindAttr=function(t,e){if($(t).attr("p-bind")){var a=$(t).attr("p-bind").split("^");a.forEach(function(e,a){var n=e.split(":"),r=n[0].replace(/\s/g,""),i=n[1];$(t).data("binding")[r]={pattern:i,related:!1}}),$(t).removeAttr("p-bind")}var n=$(t).data("binding"),r=$(t).data("context");for(var i in n)"text"!==i&&"if"!==i&&$(t).attr(i,this.convertFromPattern($(t),i,n[i].pattern,r,e))},e.prototype.bindIf=function(t,e){if($(t).attr("p-if")&&($(t).data("binding").if={pattern:$(t).attr("p-if"),related:!1},$(t).removeAttr("p-if")),$(t).data("binding").if){var a=$(t).data("binding").if.pattern,n=$(t).data("context"),r=this.convertFromPattern($(t),"if",a,n,e),i=new Function("return "+r);i()?$(t).show():$(t).hide()}},e.prototype.renderContext=function(t,e){var a=$(t);if(a.attr("p-context")){var n=a.data("context"),r=a.attr("p-context"),i=this.dividePipe(r),o=i.property,s=i.method,p=(o.split("."),this.calcu(o,a,n));s&&(p=this.convert(s,p));var c=o;""!==e&&(c=e+"."+o),this.setAlias(a,c,p),this.setRelation(o,$(t),e),this.renderChild(t,p,c)}},e.prototype.renderChild=function(t,e,a){var n=this,r=$(t);if(r.children().length>0){var i=function(t,r){t.data("context",e),n.renderSingle(t[0],e,a,$.extend({},r)),t.next().length>0&&i(t.next(),r)},o=r.children().first(),s=r.data("alias");i(o,s)}},e.prototype.renderEach=function(t,e,a){var n=this;if(t.attr("p-each")){var r=t.attr("p-each").replace(/\s/g,""),i=(r.split("."),this.calcu(r,t,e));t.data("pattern")||(t.data("pattern",t.html()),this.setRelation(r,t,a));var o=r;""!==a&&(o=a+"."+r);var s=t.data("alias"),p=t.data("pattern"),c=$("<div />").html(p).children();t.children().remove();var u=function(e){if(!(e>=i.length)){var a=c.clone(!0,!0);t.append(a),n.renderSingle(a[0],i[e],o.concat("[",e.toString(),"]"),s);var r=e+1;u(r)}};u(0)}},e.prototype.renderText=function(t,e){var a=t.data("context"),n=t.text();t.data("binding").text&&(n=t.data("binding").text.pattern);var r=this.convertFromPattern(t,"text",n,a,e);t.text(r)},e.prototype.convertFromPattern=function(t,e,a,n,r){var i=this,o=/{{\s*([\w\.\[\]\(\)\,\$@\{\}\d\+\-\*\/\s]*)\s*}}/g,s=!1;o.test(a)&&(t.data("binding")[e]||(t.data("binding")[e]={pattern:a,related:!1}),s=t.data("binding")[e].related);var p=a.replace(o,function(a,o){return s||(i.setRelation(o,t,r),t.data("binding")[e].related=!0),i.getValue(t,o,n)});return p},e.prototype.setRelation=function(t,e,a){var n=this;/^@.*/.test(t)?t=t.replace(/@(\w+)?/,function(t,a){return n.getAliasProperty(e,a)}):""!=a&&(t=a+"."+t),/^\./.test(t)&&(t=t.substr(1));var r=this._relations.filter(function(e){return e.property===t});0==r.length?this._relations.push({property:t,elements:[e]}):r[0].elements.indexOf(e)<0&&r[0].elements.push(e)},e.prototype.isSelfOrChild=function(t,e){var a=new RegExp("^"+t+"$|^"+t+"[\\[\\.]\\w+");return a.test(e)},e.prototype.isChild=function(t,e){var a=new RegExp("^"+t+"[\\[\\.]\\w+");return a.test(e)},e.prototype.getValue=function(t,e,a){var n=this.calcu(e,t,a),r=$.type(n);return"string"===r||"number"===r||"boolean"===r?n:$.extend(this.toDefault(r),n)},e.prototype.calcu=function(e,a,n){var r=this,i=e.match(/[@\w]+((?:\(.*?\))*|(?:\[.*?\])*)/g),o=i.reduce(function(e,i){var o,s=/^([@\w]+)([\(|\[].*)*/.exec(i),p=s[1];o=/^@.*/.test(p)?r.getAliasData(a,p.substr(1)):e[p];var c=s[2];if(c){var u=c.match(/\[\d+\]|\(.*\)/g);return u.reduce(function(e,i){if(/\[\d+\]/.test(i)){var o=parseInt(i.replace(/\[(\d+)\]/,"$1"));return e[o]}if(/\(.*\)/.test(i)){var s=i.replace(/\((.*)\)/,"$1").replace(/\s/,"").split(","),c=s.map(function(t){return/^[A-Za-z_\$].*$/.test(t)?r.calcu(t,a,n):new Function("return "+t)()}),u=e||r.getMethod(p)||t.getMethod(p)||window[p];return u.apply(r,c)}},o)}return o},n);return o},e.prototype.toDefault=function(t){switch(t){case"string":return"";case"number":return 0;case"boolean":return!1;case"array":return[];case"object":return{};case"function":return function(){};default:return null}},e.prototype.setAlias=function(t,e,a){var n=a||t.data("context");if(t.data("alias").self={data:n,property:e},t.attr("p-as")){var r=t.attr("p-as");t.data("alias")[r]={data:n,property:e}}},e.prototype.getAliasData=function(t,e){var a=t.data("alias");return a[e].data},e.prototype.getAliasProperty=function(t,e){var a=t.data("alias");return a[e].property},e.prototype.getMethod=function(t){return this._methods[t]},e.prototype.dividePipe=function(t){var e=t.split("|"),a=e[0].replace(/\s/g,""),n=e[1]?e[1].replace(/\s/g,""):null;return{property:a,method:n}},e.prototype.convert=function(e,a){if(/^{.*}$/.test(e)){var n=e.replace(/{|}/g,"").split(",");return n.reduce(function(t,e){var n=e.split(":");return t[n[0]]=n[1].split(".").reduce(function(t,e){return t[e]},a),t},{})}return t.hasSuffix(e,"Converter")||(e+="Converter"),this._converters[e](a)},e.prototype.register=function(e,a){$.isFunction(a)?t.hasSuffix(e,"Filter")?this._filters[e]=a:t.hasSuffix(e,"Converter")?this._converters[e]=a:this._methods[e]=a:this._variables[e]=a},e}();t.VM=e})(Pandyle||(Pandyle={}));