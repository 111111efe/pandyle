var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,s)}c((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(t){n=[6,t],i=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Pandyle;(function(t){function e(e){return t._methods[e]}function n(t,e){var n=new RegExp("^\\w+"+e+"$");return n.test(t)}function r(e,r){$.isFunction(r)?n(e,"Filter")?t._filters[e]=r:n(e,"Converter")?t._converters[e]=r:t._methods[e]=r:t._variables[e]=r}function a(e){for(var n in e)t._config[n]=e[n]}t._variables={},t._methods={},t._filters={},t._converters={},t._components={},t._config={},t.getMethod=e,t.hasSuffix=n,t.register=r,t.config=a})(Pandyle||(Pandyle={}));var Pandyle;(function(t){function e(e){return"undefined"!=typeof t._components[e]}function n(e){t._components[e.name]=e.html}function r(e){return t._components[e]}function a(a){return __awaiter(this,void 0,void 0,function(){var i,o,s,c,p;return __generator(this,function(u){switch(u.label){case 0:return i=t._config.comPath||"/components/",o=$(a).attr("p-com"),e(o)?($(a).html(r(o)),[3,4]):[3,1];case 1:return s="",s=/.*\.html$/.test(o)?o:i+o+".html",[4,fetch(s)];case 2:return c=u.sent(),[4,c.text()];case 3:p=u.sent(),p=p.replace(/<\s*script\s*>((?:.|\r|\n)*?)<\/script\s*>/g,function(t,e){return new Function(e)(),""}),p=p.replace(/<\s*style\s*>((?:.|\r|\n)*?)<\/style\s*>/g,function(t,e){var n=$("<style></style>").html(e);return $("head").append(n),""}),n({name:o,html:p}),$(a).html(p),u.label=4;case 4:return[2]}})})}t.hasComponent=e,t.addComponent=n,t.getComponent=r,t.loadComponent=a})(Pandyle||(Pandyle={})),function(t){t.fn.vm=function(t,e){void 0===e&&(e=!1);var n=this;if(n.data("vm"))return n.data("vm");var r=new Pandyle.VM(n,t,e);return n.data("vm",r),r},t.fn.inputs=function(){var t=this;if(t.data("inputs"))return t.data("inputs");var e=new Pandyle.Inputs(t);return t.data("inputs",e),e}}(jQuery);var Pandyle;(function(t){var e=function(){function t(t){this._data={},this._root=t,this.initData(),this.bindChange()}return Object.defineProperty(t.prototype,"data",{get:function(){return $.extend({},this._data)},enumerable:!0,configurable:!0}),t.prototype.set=function(t){for(var e in t){this.setData(e,t[e]);var n=this._root.find('[name="'+e+'"]');this.updateDom(n,t[e]),n.trigger("modelChange",t[e])}},t.prototype.initData=function(){var t=this;this._root.find("input,textarea,select").each(function(e,n){var r=$(n),a=r.prop("tagName"),i=r.prop("name");switch(t.initName(i),a){case"INPUT":t.initData_input(r);break;case"TEXTAREA":t.initData_normal(r);break;case"SELECT":t.initData_select(r)}})},t.prototype.initData_input=function(t){var e=t.prop("type");switch(e){case"radio":this.initData_radio(t);break;case"checkbox":this.initData_check(t);break;default:this.initData_normal(t)}},t.prototype.initData_radio=function(t){var e=t.prop("name"),n=t.val();$.isEmptyObject(this.getDataByName(e))&&this.setData(e,""),t.prop("checked")&&this.setData(e,n)},t.prototype.initData_check=function(t){var e=t.prop("name"),n=t.val();$.isEmptyObject(this.getDataByName(e))&&this.setData(e,[]),t.prop("checked")&&this.getDataByName(e).push(n)},t.prototype.initData_normal=function(t){var e=t.prop("name"),n=t.val();this.setData(e,n)},t.prototype.initData_select=function(t){var e=t.prop("name"),n=t.val()||"";this.setData(e,n)},t.prototype.bindChange=function(){var t=this;this._root.on("change","input,textarea,select",function(e){var n=$(e.currentTarget),r=n.prop("tagName");switch(r){case"INPUT":t.onChange_input(n);break;case"TEXTAREA":t.onChange_normal(n);break;case"SELECT":t.onChange_select(n)}})},t.prototype.onChange_normal=function(t){var e=t.prop("name"),n=t.val();this.setData(e,n)},t.prototype.onChange_input=function(t){switch(t.prop("type")){case"radio":this.onChange_radio(t);break;case"checkbox":this.onChange_check(t);break;default:this.onChange_normal(t)}},t.prototype.onChange_radio=function(t){var e=t.prop("name"),n=t.val();t.prop("checked")&&this.setData(e,n)},t.prototype.onChange_check=function(t){var e=t.prop("name"),n=t.val();if(t.prop("checked"))this.getDataByName(e).push(n);else{var r=this.getDataByName(e).indexOf(n);this.getDataByName(e).splice(r,1)}},t.prototype.onChange_select=function(t){var e=t.prop("name"),n=t.val();this.setData(e,n)},t.prototype.initName=function(t){t.split(".").reduce(function(t,e){return t[e]?t[e]:(t[e]={},t[e])},this._data)},t.prototype.getDataByName=function(t){return t.split(".").reduce(function(t,e){return t[e]},this._data)},t.prototype.setData=function(t,e){var n=t.split("."),r=n.pop(),a=n.reduce(function(t,e){return t[e]},this._data);a[r]=e},t.prototype.updateDom=function(t,e){var n=t.prop("tagName");switch(n){case"INPUT":this.updateDom_input(t,e);break;case"TEXTAREA":this.updateDom_normal(t,e);break;case"SELECT":this.updateDom_select(t,e);break;default:this.updateDom_normal(t,e)}},t.prototype.updateDom_input=function(t,e){var n=t.prop("type");switch(n){case"radio":this.updateDom_radio(t,e);break;case"checkbox":this.updateDom_check(t,e);break;default:this.updateDom_normal(t,e)}},t.prototype.updateDom_radio=function(t,e){t.each(function(t,n){var r=$(n);r.val()==e?r.prop("checked","checked"):r.removeProp("checked")})},t.prototype.updateDom_check=function(t,e){t.each(function(t,n){var r=$(n);e.indexOf(r.val())>-1?r.prop("checked","checked"):r.removeProp("checked")})},t.prototype.updateDom_normal=function(t,e){t.val(e)},t.prototype.updateDom_select=function(t,e){t.val(e)},t}();t.Inputs=e})(Pandyle||(Pandyle={}));var Pandyle;(function(t){var e=function(){function e(t,e,n){void 0===n&&(n=!0),this._data=$.extend({},e),this._root=t,this._relations=[],this._methods={},this._filters={},this._converters={},this._variables={},this._defaultAlias={root:{data:this._data,property:""},window:{data:window,property:"@window"}},n&&this.run()}return e.prototype.set=function(t){var e=this,n=function(n){var a=n.split("."),i=a.pop(),o=r._data;if(a.length>0&&(o=a.reduce(function(t,e){return t[e]},r._data)),o[i]=t[n],$.isArray(o[i]))for(var s=r._relations.length-1;s>=0;s--)r.isChild(n,r._relations[s].property)&&r._relations.splice(s,1);var c=r._relations.filter(function(t){return e.isSelfOrChild(n,t.property)});c.length>0&&c[0].elements.forEach(function(t){e.render(t)})},r=this;for(var a in t)n(a)},e.prototype.get=function(t){var e=this;switch($.type(t)){case"array":return t.map(function(t){return e.get(t)});case"string":return this.getValue(this._root,t,this._data);case"object":var n={};for(var r in t)n[r]=this.getValue(this._root,t[r],this._data);return n;default:return null}},e.prototype.run=function(){this.render(this._root,this._data,"",this._defaultAlias)},e.prototype.render=function(t,e,n,r){var a=this;t.each(function(t,i){a.renderSingle(i,e,n,$.extend({},r))})},e.prototype.renderSingle=function(e,n,r,a){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return i=$(e),i.data("context")||i.data("context",n),i.data("binding")||i.data("binding",{}),a&&i.data("alias",a),n=i.data("context"),this.bindAttr(e,r),this.bindIf(e,r),"C"!==i[0].tagName?[3,2]:[4,t.loadComponent(e)];case 1:o.sent(),o.label=2;case 2:return i.attr("p-context")?this.renderContext(e,r):i.attr("p-each")?(this.setAlias(i,r,n),this.renderEach(i,n,r)):i.children().length>0?(this.setAlias(i,r,n),this.renderChild(e,n,r)):(this.setAlias(i,r,n),this.renderText(i,r)),[2]}})})},e.prototype.bindAttr=function(t,e){if($(t).attr("p-bind")){var n=$(t).attr("p-bind").split("^");n.forEach(function(e,n){var r=e.split(":"),a=r[0].replace(/\s/g,""),i=r[1];$(t).data("binding")[a]={pattern:i,related:!1}}),$(t).removeAttr("p-bind")}var r=$(t).data("binding"),a=$(t).data("context");for(var i in r)"text"!==i&&"if"!==i&&$(t).attr(i,this.convertFromPattern($(t),i,r[i].pattern,a,e))},e.prototype.bindIf=function(t,e){if($(t).attr("p-if")&&($(t).data("binding").if={pattern:$(t).attr("p-if"),related:!1},$(t).removeAttr("p-if")),$(t).data("binding").if){var n=$(t).data("binding").if.pattern,r=$(t).data("context"),a=this.convertFromPattern($(t),"if",n,r,e),i=new Function("return "+a);i()?$(t).show():$(t).hide()}},e.prototype.renderContext=function(t,e){var n=$(t);if(n.attr("p-context")){var r=n.data("context"),a=n.attr("p-context"),i=this.dividePipe(a),o=i.property,s=i.method,c=o.split("."),p=c.reduce(function(t,e){return t[e]},r);s&&(p=this.convert(s,p));var u=o;""!==e&&(u=e+"."+o),this.setAlias(n,u,p),this.setRelation(o,$(t),e),this.renderChild(t,p,u)}},e.prototype.renderChild=function(t,e,n){var r=$(t);if(r.children().length>0){var a=this,i=function(t,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return t.data("context",e),[4,a.renderSingle(t[0],e,n,$.extend({},r))];case 1:return o.sent(),t.next().length>0&&i(t.next(),r),[2]}})})},o=r.children().first(),s=r.data("alias");i(o,s)}},e.prototype.renderEach=function(t,e,n){if(t.attr("p-each")){var r=t.attr("p-each").replace(/\s/g,""),a=r.split("."),i=a.reduce(function(t,e){return t[e]},e);t.data("pattern")||(t.data("pattern",t.html()),this.setRelation(r,t,n));var o=r;""!==n&&(o=n+"."+r);var s=t.data("alias"),c=t.data("pattern"),p=$("<div />").html(c).children();t.children().remove();for(var u=0;u<i.length;u++){var d=p.clone(!0,!0);t.append(d),this.render(d,i[u],o.concat("[",u.toString(),"]"),s)}}},e.prototype.renderText=function(t,e){var n=t.data("context"),r=t.text();t.data("binding").text&&(r=t.data("binding").text.pattern);var a=this.convertFromPattern(t,"text",r,n,e);t.text(a)},e.prototype.convertFromPattern=function(t,e,n,r,a){var i=this,o=/{{\s*([\w\.\[\]\(\)\,\$@\{\}\d\+\-\*\/\s]*)\s*}}/g,s=!1;o.test(n)&&(t.data("binding")[e]||(t.data("binding")[e]={pattern:n,related:!1}),s=t.data("binding")[e].related);var c=n.replace(o,function(n,o){return s||(i.setRelation(o,t,a),t.data("binding")[e].related=!0),i.getValue(t,o,r)});return c},e.prototype.setRelation=function(t,e,n){var r=this;/^@.*/.test(t)?t=t.replace(/@(\w+)?/,function(t,n){return r.getAliasProperty(e,n)}):""!=n&&(t=n+"."+t),/^\./.test(t)&&(t=t.substr(1));var a=this._relations.filter(function(e){return e.property===t});0==a.length?this._relations.push({property:t,elements:[e]}):a[0].elements.indexOf(e)<0&&a[0].elements.push(e)},e.prototype.isSelfOrChild=function(t,e){var n=new RegExp("^"+t+"$|^"+t+"[\\[\\.]\\w+");return n.test(e)},e.prototype.isChild=function(t,e){var n=new RegExp("^"+t+"[\\[\\.]\\w+");return n.test(e)},e.prototype.getValue=function(e,n,r){var a=this,i=n.match(/[@\w]+((?:\(.*?\))*|(?:\[.*?\])*)/g),o=i.reduce(function(n,i){var o,s=/^([@\w]+)([\(|\[].*)*/.exec(i),c=s[1];o=/^@.*/.test(c)?a.getAliasData(e,c.substr(1)):n[c];var p=s[2];if(p){var u=p.match(/\[\d+\]|\(.*\)/g);return u.reduce(function(n,i){if(/\[\d+\]/.test(i)){var o=parseInt(i.replace(/\[(\d+)\]/,"$1"));return n[o]}if(/\(.*\)/.test(i)){var s=i.replace(/\((.*)\)/,"$1").replace(/\s/,"").split(","),p=s.map(function(t){return/^[A-Za-z_\$].*$/.test(t)?a.getValue(e,t,r):new Function("return "+t)()}),u=n||a.getMethod(c)||t.getMethod(c)||window[c];return u.apply(a,p)}},o)}return o},r),s=$.type(o);return"string"===s||"number"===s||"boolean"===s?o:$.extend(this.toDefault(s),o)},e.prototype.toDefault=function(t){switch(t){case"string":return"";case"number":return 0;case"boolean":return!1;case"array":return[];case"object":return{};case"function":return function(){};default:return null}},e.prototype.setAlias=function(t,e,n){var r=n||t.data("context");if(t.data("alias").self={data:r,property:e},t.attr("p-as")){var a=t.attr("p-as");t.data("alias")[a]={data:r,property:e}}},e.prototype.getAliasData=function(t,e){var n=t.data("alias");return n[e].data},e.prototype.getAliasProperty=function(t,e){var n=t.data("alias");return n[e].property},e.prototype.getMethod=function(t){return this._methods[t]},e.prototype.dividePipe=function(t){var e=t.split("|"),n=e[0].replace(/\s/g,""),r=e[1]?e[1].replace(/\s/g,""):null;return{property:n,method:r}},e.prototype.convert=function(e,n){if(/^{.*}$/.test(e)){var r=e.replace(/{|}/g,"").split(",");return r.reduce(function(t,e){var r=e.split(":");return t[r[0]]=r[1].split(".").reduce(function(t,e){return t[e]},n),t},{})}return t.hasSuffix(e,"Converter")||(e+="Converter"),this._converters[e](n)},e.prototype.register=function(e,n){$.isFunction(n)?t.hasSuffix(e,"Filter")?this._filters[e]=n:t.hasSuffix(e,"Converter")?this._converters[e]=n:this._methods[e]=n:this._variables[e]=n},e}();t.VM=e})(Pandyle||(Pandyle={}));