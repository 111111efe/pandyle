var Pandyle;(function(t){function e(e){return t._methods[e]}function r(t,e){var r=new RegExp("^\\w+"+e+"$");return r.test(t)}function n(e,n){t.$.isFunction(n)?r(e,"Filter")?t._filters[e]=n:r(e,"Converter")?t._converters[e]=n:t._methods[e]=n:t._variables[e]=n}function a(e){for(var r in e)t._config[r]=e[r]}t._variables={},t._methods={},t._filters={},t._converters={},t._components={},t._config={},t.getMethod=e,t.hasSuffix=r,t.register=n,t.config=a})(Pandyle||(Pandyle={}));var Pandyle;(function(t){function e(e){return"undefined"!=typeof t._components[e]}function r(e){t._components[e.name]=e.html}function n(e){return t._components[e]}function a(a){function i(e,n){e=e.replace(/<\s*script\s*>((?:.|\r|\n)*?)<\/script\s*>/g,function(t,e){return new Function(e)(),""}),e=e.replace(/<\s*style\s*>((?:.|\r|\n)*?)<\/style\s*>/g,function(e,r){var n="<style>"+r+"</style>";return t.$("head").append(n),""}),r({name:n,html:e}),t.$(a).html(e)}var o=t.$(a).attr("p-com");if(o=t.$.trim(o),e(o))t.$(a).html(n(o));else{var s="";if(/^@.*/.test(o))s=o;else{var p=o.split("."),c=t._config.comPath?t._config.comPath.Default||"./components/{name}.html":"./components/{name}.html";p.length>1?(c=t._config.comPath[p[0]],s=c.replace(/{.*}/g,p[1])):s=c.replace(/{.*}/g,o)}t.$.ajax({url:s,async:!1,success:function(t){i(t,o)}})}}t.hasComponent=e,t.addComponent=r,t.getComponent=n,t.loadComponent=a})(Pandyle||(Pandyle={})),function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"object"==typeof module?exports=module.exports=e(require("jquery")):e(t.jQuery)}(this,function(t){return Pandyle.$=t,t.fn.vm=function(t,e){void 0===e&&(e=!0);var r=this;if(r.data("vm"))return r.data("vm");var n=new Pandyle.VM(r,t,e);return r.data("vm",n),n},t.fn.inputs=function(){var t=this;if(t.data("inputs"))return t.data("inputs");var e=new Pandyle.Inputs(t);return t.data("inputs",e),e},Pandyle});var Pandyle;(function(t){var e=function(){function e(t){this._data={},this._root=t,this.initData(),this.bindChange()}return e.prototype.data=function(){return t.$.extend({},this._data)},e.prototype.set=function(t){for(var e in t){this.setData(e,t[e]);var r=this._root.find('[name="'+e+'"]');this.updateDom(r,t[e]),r.trigger("modelChange",t[e])}},e.prototype.initData=function(){var e=this;this._root.find("input,textarea,select").each(function(r,n){var a=t.$(n),i=a.prop("tagName"),o=a.prop("name"),s=a.val()||"";switch(e.initName(o),i){case"INPUT":e.initData_input(a,o,s);break;case"TEXTAREA":e.initData_normal(a,o,s);break;case"SELECT":e.initData_select(a,o,s)}})},e.prototype.initData_input=function(t,e,r){var n=t.prop("type");switch(n){case"radio":this.initData_radio(t,e,r);break;case"checkbox":this.initData_check(t,e,r);break;default:this.initData_normal(t,e,r)}},e.prototype.initData_radio=function(e,r,n){t.$.isEmptyObject(this.getDataByName(r))&&this.setData(r,""),e.prop("checked")&&this.setData(r,n)},e.prototype.initData_check=function(e,r,n){t.$.isEmptyObject(this.getDataByName(r))&&this.setData(r,[]),e.prop("checked")&&this.getDataByName(r).push(n)},e.prototype.initData_normal=function(t,e,r){this.setData(e,r)},e.prototype.initData_select=function(t,e,r){this.setData(e,r)},e.prototype.bindChange=function(){var e=this;this._root.on("change viewChange","input,textarea,select",function(r){var n=t.$(r.currentTarget),a=n.prop("tagName"),i=n.prop("name"),o=n.val();switch(a){case"INPUT":e.onChange_input(n,i,o);break;case"TEXTAREA":e.onChange_normal(n,i,o);break;case"SELECT":e.onChange_select(n,i,o)}e.callBack&&e.callBack(i,o)})},e.prototype.onChange_normal=function(t,e,r){this.setData(e,r)},e.prototype.onChange_input=function(t,e,r){switch(t.prop("type")){case"radio":this.onChange_radio(t,e,r);break;case"checkbox":this.onChange_check(t,e,r);break;default:this.onChange_normal(t,e,r)}},e.prototype.onChange_radio=function(t,e,r){t.prop("checked")&&this.setData(e,r)},e.prototype.onChange_check=function(t,e,r){if(t.prop("checked"))this.getDataByName(e).push(r);else{var n=this.getDataByName(e).indexOf(r);this.getDataByName(e).splice(n,1)}},e.prototype.onChange_select=function(t,e,r){this.setData(e,r)},e.prototype.initName=function(t){t.split(".").reduce(function(t,e){return t[e]?t[e]:(t[e]={},t[e])},this._data)},e.prototype.getDataByName=function(t){return t.split(".").reduce(function(t,e){return t[e]},this._data)},e.prototype.setData=function(t,e){var r=t.split("."),n=r.pop(),a=r.reduce(function(t,e){return t[e]},this._data);a[n]=e},e.prototype.updateDom=function(t,e){var r=t.prop("tagName");switch(r){case"INPUT":this.updateDom_input(t,e);break;case"TEXTAREA":this.updateDom_normal(t,e);break;case"SELECT":this.updateDom_select(t,e);break;default:this.updateDom_normal(t,e)}},e.prototype.updateDom_input=function(t,e){var r=t.prop("type");switch(r){case"radio":this.updateDom_radio(t,e);break;case"checkbox":this.updateDom_check(t,e);break;default:this.updateDom_normal(t,e)}},e.prototype.updateDom_radio=function(e,r){e.each(function(e,n){var a=t.$(n);a.val()==r?a.prop("checked","checked"):a.prop("checked",!1)})},e.prototype.updateDom_check=function(e,r){e.each(function(e,n){var a=t.$(n);r.indexOf(a.val())>-1?a.prop("checked","checked"):a.prop("checked",!1)})},e.prototype.updateDom_normal=function(t,e){t.val(e)},e.prototype.updateDom_select=function(t,e){t.val(e)},e}();t.Inputs=e})(Pandyle||(Pandyle={})),Array.prototype.filter||(Array.prototype.filter=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var r=new Array,n=arguments[1],a=0;a<e;a++)if(a in this){var i=this[a];t.call(n,i,a,this)&&r.push(i)}return r}),Array.prototype.forEach||(Array.prototype.forEach=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var r=arguments[1],n=0;n<e;n++)n in this&&t.call(r,this[n],n,this)}),Array.prototype.map||(Array.prototype.map=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var r=new Array(e),n=arguments[1],a=0;a<e;a++)a in this&&(r[a]=t.call(n,this[a],a,this));return r}),Array.prototype.reduce||(Array.prototype.reduce=function(t,e){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var r,n,a=this.length>>>0,i=!1;for(1<arguments.length&&(n=e,i=!0),r=0;a>r;++r)this.hasOwnProperty(r)&&(i?n=t(n,this[r],r,this):(n=this[r],i=!0));if(!i)throw new TypeError("Reduce of empty array with no initial value");return n}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){for(var e=0,r=this.length;e<r;e++)if(this[e]===t)return e;return-1});var Pandyle;(function(t){var e=function(){function e(e,r,n){void 0===n&&(n=!0),this._data=t.$.extend({},r),this._root=e,this._relations=[],this._methods={},this._filters={},this._converters={},this._variables={},this._defaultAlias={root:{data:this._data,property:""},window:{data:window,property:"@window"}},n&&this.run()}return e.prototype.set=function(e){var r=this,n=function(n){var i=n.split(/[\[\]\.]/).filter(function(t){return""!=t}),o=i.pop(),s=a._data;if(i.length>0&&(s=i.reduce(function(t,e){return t[e]},a._data)),s[o]=e[n],t.$.isArray(s[o]))for(var p=a._relations.length-1;p>=0;p--)a.isChild(n,a._relations[p].property)&&a._relations.splice(p,1);var c=a._relations.filter(function(t){return r.isSelfOrChild(n,t.property)});c.length>0&&c[0].elements.forEach(function(t){r.render(t)})},a=this;for(var i in e)n(i)},e.prototype.get=function(e){var r=this;if(!e)return t.$.extend({},this._data);switch(t.$.type(e)){case"array":return e.map(function(t){return r.get(t)});case"string":return this.getValue(this._root,e,this._data);case"object":var n={};for(var a in e)n[a]=this.getValue(this._root,e[a],this._data);return n;default:return null}},e.prototype.run=function(){this.render(this._root,this._data,"",this._defaultAlias)},e.prototype.render=function(e,r,n,a){var i=this;e.each(function(e,o){i.renderSingle(o,r,n,t.$.extend({},a))})},e.prototype.renderSingle=function(e,r,n,a){var i=t.$(e);i.data("context")||i.data("context",r),i.data("binding")||i.data("binding",{}),a&&!t.$.isEmptyObject(a)&&i.data("alias",a),r=i.data("context"),i.attr("p-for")?(this.setAlias(i,n,r),this.renderFor(i,r,n)):(this.bindAttr(e,n),this.bindIf(e,n),i.attr("p-com")&&t.loadComponent(e),i.attr("p-context")?this.renderContext(e,n):i.attr("p-each")?(this.setAlias(i,n,r),this.renderEach(i,r,n)):i.children().length>0?(this.setAlias(i,n,r),this.renderChild(e,r,n)):(this.setAlias(i,n,r),this.renderText(i,n)))},e.prototype.bindAttr=function(e,r){if(t.$(e).attr("p-bind")){var n=t.$(e).attr("p-bind").split("^");n.forEach(function(r,n){var a=r.match(/^\s*([\w-]+)\s*:\s*(.*)$/),i=a[1],o=a[2].replace(/\s*$/,"");t.$(e).data("binding")[i]={pattern:o,related:!1}}),t.$(e).removeAttr("p-bind")}var a=t.$(e).data("binding"),i=t.$(e).data("context");for(var o in a)"text"!==o&&"if"!==o&&t.$(e).attr(o,this.convertFromPattern(t.$(e),o,a[o].pattern,i,r))},e.prototype.bindIf=function(e,r){if(t.$(e).attr("p-if")&&(t.$(e).data("binding").If={pattern:t.$(e).attr("p-if"),related:!1},t.$(e).removeAttr("p-if")),t.$(e).data("binding").If){var n=t.$(e).data("binding").If.pattern,a=t.$(e).data("context"),i=this.convertFromPattern(t.$(e),"If",n,a,r),o=new Function("return "+i);o()?t.$(e).show():t.$(e).hide()}},e.prototype.renderContext=function(e,r){var n=t.$(e);if(n.attr("p-context")){var a=n.data("context"),i=n.attr("p-context"),o=this.dividePipe(i),s=o.property,p=o.method,c=this.calcu(s,n,a);p&&(c=this.convert(p,t.$.extend({},c)));var u=s;""!==r&&(u=r+"."+s),this.setAlias(n,u,c),this.setRelation(s,t.$(e),r),this.renderChild(e,c,u)}},e.prototype.renderChild=function(e,r,n){var a=this,i=t.$(e);if(i.children().length>0){var o=i.data("alias");i.children().each(function(e,i){var s=t.$(i);s.data("context",r),a.renderSingle(s[0],r,n,t.$.extend({},o))})}},e.prototype.renderEach=function(e,r,n){var a=this;if(e.attr("p-each")){var i=e.attr("p-each").replace(/\s/g,""),o=this.dividePipe(i),s=o.property,p=o.method,c=this.calcu(s,e,r);p&&(c=this.filter(p,c)),e.data("pattern")||(e.data("pattern",e.html()),this.setRelation(s,e,n));var u=s;""!==n&&(u=n+"."+s);var d=e.data("alias"),h=e.data("pattern"),f=t.$("<div />").html(h).children();e.children().remove(),c.forEach(function(r,n){var i=f.clone(!0,!0);e.append(i),a.render(i,r,u.concat("[",n.toString(),"]"),t.$.extend(d,{index:{data:n,property:"@index"}}))})}},e.prototype.renderFor=function(r,n,a){var i=this;if(r.attr("p-for")){r.data("uid")||r.data("uid",e._uid++);var o=r.attr("p-for").replace(/\s/g,""),s=this.dividePipe(o),p=s.property,c=s.method,u=this.calcu(p,r,n);c&&(u=this.filter(c,u)),r.data("pattern")||r.data("pattern",r.prop("outerHTML"));var d=p;""!==a&&(d=a+"."+p);var h=r.data("alias"),f=r.data("pattern"),l=f.replace(/p-for=((".*?")|('.*?'))/g,""),y=t.$(l);r.siblings("[uid="+r.data("uid")+"]").remove();var v=function(e,s,c){if(0!==s.length){var u=y.clone(!0,!0);e.after(u),i.render(u,s.shift(),d.concat("[",c.toString(),"]"),t.$.extend(h,{index:{data:c,property:"@index"}})),0===c?(u.data("uid",r.data("uid")),u.data("pattern",f),u.attr("p-for",o),u.data("context",n),i.setRelation(p,u,a)):u.attr("uid",r.data("uid")),v(u,s,++c)}};v(r,u,0),r.remove()}},e.prototype.renderText=function(t,e){var r=t.data("context"),n=t.text();t.data("binding").text&&(n=t.data("binding").text.pattern);var a=this.convertFromPattern(t,"text",n,r,e);t.html(a)},e.prototype.convertFromPattern=function(t,e,r,n,a){var i=this,o=/{{\s*([\w\.\[\]\(\)\,\$@\{\}\d\+\-\*\/\s]*)\s*}}/g,s=!1;o.test(r)&&(t.data("binding")[e]||(t.data("binding")[e]={pattern:r,related:!1}),s=t.data("binding")[e].related);var p=r.replace(o,function(r,o){return s||(i.setRelation(o,t,a),t.data("binding")[e].related=!0),i.getValue(t,o,n)});return p},e.prototype.setRelation=function(t,e,r){var n=this;/^@.*/.test(t)?t=t.replace(/@(\w+)?/,function(t,r){return n.getAliasProperty(e,r)}):""!=r&&(t=r+"."+t),/^\./.test(t)&&(t=t.substr(1));var a=this._relations.filter(function(e){return e.property===t});0==a.length?this._relations.push({property:t,elements:[e]}):a[0].elements.indexOf(e)<0&&a[0].elements.push(e)},e.prototype.isSelfOrChild=function(t,e){t=t.replace(/[\[\]\(\)\.]/g,function(t){return"\\"+t});var r=new RegExp("^"+t+"$|^"+t+"[\\[\\.]\\w+");return r.test(e)},e.prototype.isChild=function(t,e){var r=new RegExp("^"+t+"[\\[\\.]\\w+");return r.test(e)},e.prototype.getValue=function(e,r,n){var a=this.calcu(r,e,n),i=t.$.type(a);return"string"===i||"number"===i||"boolean"===i?a:t.$.extend(this.toDefault(i),a)},e.prototype.calcu=function(e,r,n){var a=this,i=e.match(/[@\w]+((?:\(.*?\))*|(?:\[.*?\])*)/g);if(!i)return"";var o=i.reduce(function(e,i){var o,s=/^([@\w]+)([\(|\[].*)*/.exec(i),p=s[1];o=/^@.*/.test(p)?a.getAliasData(r,p.substr(1)):e[p];var c=s[2];if(c){var u=c.match(/\[\d+\]|\(.*\)/g);return u.reduce(function(e,i){if(/\[\d+\]/.test(i)){var o=parseInt(i.replace(/\[(\d+)\]/,"$1"));return e[o]}if(/\(.*\)/.test(i)){var s=i.replace(/\((.*)\)/,"$1").replace(/\s/,"").split(","),c=s.map(function(t){return/^[A-Za-z_\$\@].*$/.test(t)?a.calcu(t,r,n):(""===t&&(t='""'),new Function("return "+t)())}),u=e||a.getMethod(p)||t.getMethod(p)||window[p];return u.apply(a,c)}},o)}return o},n);return o},e.prototype.toDefault=function(t){switch(t){case"string":return"";case"number":return 0;case"boolean":return!1;case"array":return[];case"object":return{};case"function":return function(){};default:return null}},e.prototype.setAlias=function(t,e,r){var n=r||t.data("context");if(t.data("alias").self={data:n,property:e},t.attr("p-as")){var a=t.attr("p-as");t.data("alias")[a]={data:n,property:e}}},e.prototype.getAliasData=function(t,e){var r=t.data("alias");return r[e].data},e.prototype.getAliasProperty=function(t,e){var r=t.data("alias");return r[e].property},e.prototype.getMethod=function(t){return this._methods[t]},e.prototype.dividePipe=function(t){var e=t.split("|"),r=e[0].replace(/\s/g,""),n=e[1]?e[1].replace(/\s/g,""):null;return{property:r,method:n}},e.prototype.convert=function(e,r){if(/^{.*}$/.test(e)){var n=e.replace(/{|}/g,"").split(",");return n.reduce(function(t,e){var n=e.split(":");return/^[a-zA-z$_]+/.test(n[1])?t[n[0]]=n[1].split(".").reduce(function(t,e){return t[e]},r):t[n[0]]=new Function("return "+n[1])(),t},{})}return t.hasSuffix(e,"Converter")||(e+="Converter"),this._converters[e](r)},e.prototype.filter=function(e,r){return t.hasSuffix(e,"Filter")||(e+="Filter"),this._filters[e](r)},e.prototype.register=function(e,r){t.$.isFunction(r)?t.hasSuffix(e,"Filter")?this._filters[e]=r:t.hasSuffix(e,"Converter")?this._converters[e]=r:this._methods[e]=r:this._variables[e]=r},e}();e._uid=1,t.VM=e})(Pandyle||(Pandyle={}));